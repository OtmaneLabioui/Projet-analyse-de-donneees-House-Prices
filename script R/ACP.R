## --------------------------------------------------------------------------------------------------------------------
library(readxl)
data_house <- read_excel("California_Houses.xlsx")
data_house$Median_Income <- as.numeric(data_house$Median_Income)
data_house$Distance_to_coast <- as.numeric(data_house$Distance_to_coast)
data_house$Distance_to_LA <- as.numeric(data_house$Distance_to_LA)
data_house$Distance_to_SanDiego <- as.numeric(data_house$Distance_to_SanDiego)
data_house$Distance_to_SanJose <- as.numeric(data_house$Distance_to_SanJose)
data_house$Distance_to_SanFrancisco <- as.numeric(data_house$Distance_to_SanFrancisco)


## --------------------------------------------------------------------------------------------------------------------
summary(data_house)
str(data_house)


## --------------------------------------------------------------------------------------------------------------------
pairs(data_house)


## --------------------------------------------------------------------------------------------------------------------
library(FactoMineR)
res<-PCA(data_house,axes=c(1,2))
attributes(res)


## --------------------------------------------------------------------------------------------------------------------
library(psych)
KMO(cor(data_house))




## --------------------------------------------------------------------------------------------------------------------
res$eig[,1]



## --------------------------------------------------------------------------------------------------------------------
res$eig[,2]



## --------------------------------------------------------------------------------------------------------------------
res$eig[,3]



## --------------------------------------------------------------------------------------------------------------------
plot(1:12,res$eig[,1],type="b",ylab="Valeurs propres",xlab="Composantes",main="graphique des valeurs propres")
barplot(res$eig[,1],main="Eigenvalues", names.arg=paste("dim",1:nrow(res$eig)))


## --------------------------------------------------------------------------------------------------------------------
nrow(res$eig)
var(res$eig[1:12,1])*11/(var(res$eig[,1])*11)
#supérieur à 0,05 
var(res$eig[2:12,1])*10/(var(res$eig[,1])*11)
#supérieur à 0,05
var(res$eig[3:12,1])*9/(var(res$eig[,1])*11)
#supérieur à 0,05
var(res$eig[4:12,1])*8/(var(res$eig[,1])*11)
#inférieur à 0,05 





## --------------------------------------------------------------------------------------------------------------------
print(res$var$cos2,digit=2)


## --------------------------------------------------------------------------------------------------------------------
print(t(apply(res$var$cos2,1,cumsum)),digit=2)


## --------------------------------------------------------------------------------------------------------------------

cos_totale<-sort(t(apply(res$var$cos2,1,cumsum))[,3],decreasing=TRUE)
print(t(apply(res$var$cos2,1,cumsum))[,1:3],digit=2)
barplot(cos_totale,ylab="Qualite de representation",main="Cos2 total des variables sur Dim.1, Dim.2 et Dim.3")




## --------------------------------------------------------------------------------------------------------------------
for (i in 1:12){
if (0.7 < cos_totale[i] ) print(cos_totale[i])
}



## --------------------------------------------------------------------------------------------------------------------

for (i in 1:12){
if (0.5<cos_totale[i]&& cos_totale[i]<0.7) print(cos_totale[i])
}




## --------------------------------------------------------------------------------------------------------------------
for (i in 1:12){
if ( cos_totale[i]< 0.5) print(cos_totale[i])
}



## --------------------------------------------------------------------------------------------------------------------
contrib<-data.frame(res$var$contrib)
print(res$var$contrib,digit=2)



## --------------------------------------------------------------------------------------------------------------------
cah<-HCPC(contrib,nb.clust=-1)
cah$desc.var



## --------------------------------------------------------------------------------------------------------------------

plot(res$var$cor[,1],res$var$cor[,2],xlab="Dim 1",ylab="Dim 2")



## --------------------------------------------------------------------------------------------------------------------
dim1=res$var$cor[,1]
for (i in 1:12){
if (abs(dim1[i])>0.9) print(dim1[i])
}



## --------------------------------------------------------------------------------------------------------------------
print(res$ind$cos2,digit=2)


## --------------------------------------------------------------------------------------------------------------------
head(t(apply(res$ind$cos2,1,cumsum)),digit=2)


## --------------------------------------------------------------------------------------------------------------------

cos_totale_ind<-sort(t(apply(res$ind$cos2,1,cumsum))[,3],decreasing=TRUE)
head(t(apply(res$ind$cos2,1,cumsum))[,1:3],digit=2)
barplot(cos_totale_ind,ylab="Qualite de representation",main="Cos2 total d'individus sur Dim.1, Dim.2 et Dim.3")




## --------------------------------------------------------------------------------------------------------------------
for (i in 1:109){
if (0.7 < cos_totale_ind[i] ) print(cos_totale_ind[i])
}



## --------------------------------------------------------------------------------------------------------------------

for (i in 1:109){
if (0.5<cos_totale_ind[i]&& cos_totale_ind[i]<0.7) print(cos_totale_ind[i])
}




## --------------------------------------------------------------------------------------------------------------------
for (i in 1:109){
if ( cos_totale_ind[i]< 0.5) print(cos_totale_ind[i])
}



## --------------------------------------------------------------------------------------------------------------------
contrib_ind<-data.frame(res$ind$contrib)
print(res$ind$contrib,digit=2)


## --------------------------------------------------------------------------------------------------------------------
cah_ind<-HCPC(contrib_ind,nb.clust=-1)
cah_ind$desc.var


## --------------------------------------------------------------------------------------------------------------------
plot(res,invisible="var")
#plot(res$ind$coord[,1],res$ind$coord[,2],xlab="Dim 1",ylab="Dim 2")


## --------------------------------------------------------------------------------------------------------------------
plot(res$ind$coord[,1],res$ind$coord[,2],xlab="Dim 1",ylab="Dim 2")

